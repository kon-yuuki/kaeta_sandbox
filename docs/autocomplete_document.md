# オートコンプリート機能設計書

## データベーススキーマ

### TodoItems（買い物リスト）

| カラム名 | 型 | 論理的な役割 |
|----------|----|--------------| 
| id | text (UUID) | アイテムの一意識別（主キー） |
| name | text | 画面に表示する名前（例：人参） |
| category | text | カテゴリー |
| is_completed | boolean | 買い終わったかどうかの状態 |
| priority | integer | 重要度（0:普通, 1:重要） |
| family_id | text | 家族グループID（共有の単位） |
| user_id | text | 作成したユーザーのID |

### SearchKeywords（検索・サジェスト用）

| カラム名 | 型 | 論理的な役割 |
|----------|----|--------------| 
| id | text (UUID) | キーワードの一意識別（主キー） |
| keyword | text | 変換後の正解（例：人参） |
| reading | text | 検索に使う読み（例：にんじん） |
| family_id | text | 家族間で辞書を共有するためのID |

## 予測変換システムの設計方針

| 項目 | 内容（仕様） | 論理的なメリット |
|------|-------------|------------------|
| **データの保持** | 1つのアイテムに対し、「漢字等の正式名」と、パッケージで生成した「唯一のひらがな読み」をセットで保存 | DBが肥大化せず、検索効率が最大化される |
| **正規化の手段** | jp_transliterate パッケージを全面的に使用 | 漢字・カタカナ・全角半角の揺れを、1つのロジックで「ひらがな」に統合できる |
| **実行タイミング** | アイテムを保存（登録）するボタンが押された瞬間 | 入力中のリアルタイム処理を避け、デバイスの負荷を最小限に抑える |
| **学習の仕組み** | 特別な「学習ロジック」は組まず、「ユーザーが確定させた最終的な名前」をそのままパッケージに渡して「読み」を生成する | プログラムがシンプルになり、バグの混入を防げる |
| **検索アルゴリズム** | 入力中の文字に対し、DBの reading カラムを `LIKE '入力文字%'` で前方一致検索 | 「にん」と打つだけで、内部に「にんじん」を持つ「人参」を即座にヒットさせることが可能 |


## 予測変換システムの全容

| 構成要素 | 役割 | データソース |
|----------|------|--------------|
| **初期辞書（静的）** | インストール直後から「人参」「牛乳」などを提案する | アプリ内の `assets/master_items.json` |
| **学習履歴（動的）** | 家族が実際に登録した「わが家特有の名前」を優先する | DBの `search_keywords` テーブル |
| **変換エンジン** | 漢字・カナ・全角を「ひらがな（読み）」に統一する | `jp_transliterate` パッケージ |


## 初期辞書（JSON）の推奨構造

```json
[
  {
    "name": "人参",
    "reading": "にんじん",
    "category": "野菜"
  },
  {
    "name": "牛乳",
    "reading": "ぎゅうにゅう",
    "category": "乳製品"
  },
  {
    "name": "トイレットペーパー",
    "reading": "といれっとぺーぱー",
    "category": "日用品"
  }
]
```

## テーブルスキーマ（Drift）の最終形

```dart
class SearchKeywords extends Table {
  TextColumn get id => text().clientDefault(() => const Uuid().v4())();
  TextColumn get keyword => text()(); // 表示名（人参）
  TextColumn get reading => text()(); // 検索用かな（にんじん）
  TextColumn get familyId => text().nullable()(); // 家族ID（初期データはnull、学習データはIDあり）

  @override
  Set<Column> get primaryKey => {id};
}
```