# 招待機能 実機検証ログ

最終更新日: 2026-02-16

## 1. 検証パターン一覧
| パターンID | 実施状態 | インストール状態 | ユーザー状態 | 主な確認ポイント |
|---|---|---|---|---|
| U1（旧P1a/P1b） | A/B | 済み | アカウントあり・オンボ未完了（ログイン状態は問わない） | 現実装では「未完了かつ未所属」が原則発生しないため、通常は P7 で検証 |
| P2 | A/B | 済み | アカウントあり・オンボ完了・ログイン済み・未所属 | 参加確認から即参加できる |
| P3 | A/B | 済み | アカウントあり・オンボ完了・未ログイン | ログイン後に招待復帰して参加 |
| P4a | A/B | 未インストール | 既存アカウント・オンボ完了 | Webフォールバック後に参加完了 |
| P4b | A/B | 未インストール | 既存アカウント・オンボ未完了 | Webフォールバック後に招待付きオンボ再開 |
| P5 | A/B | 未インストール | アカウントなし | 新規登録後に招待復帰して参加 |
| P6 | A/B | 済み or 未インストール | 無効招待（notFound/expired） | エラー画面遷移とコンテキストクリア |
| P7 | A/B | 済み | 別チーム所属済み | 参加拒否（alreadyHasFamily）と状態不変 |
| S8（必須） | A/B | 済み or 未インストール | 使用済みリンクを別ユーザーが利用 | 無効招待として拒否できる |

注記: 現実装ではアカウント作成時にチーム作成されるため、「オンボ未完了かつ家族未所属」は原則起こり得ない。

## 2. アプリ状態パターン（実施対象）
| 実行ID | アプリ状態 | 定義 | 優先度 |
|---|---|---|---|
| A | バックグラウンド | アプリは終了していないが画面は前面にない状態 | 高 |
| B | 停止（タスクキル後） | アプリプロセスが完全終了した状態 | 高 |

運用ルール:
1. 各ケースは原則 `A` と `B` の両方で実施する。
2. 片方のみ実施の場合は、未実施理由を備考に残す。

## 3. 記録テンプレート
- ケースID:
- 実行ID（A/B）:
- 実施日時:
- 端末OS / アプリ版:
- 事前状態（インストール/ログイン/オンボ）:
- 実施結果: Pass / Fail
- 失敗時の事象:
- スクリーンショット or 動画:
- 備考（再現条件、回避策）:

## 4. 実績
| ケースID | 実行ID | 実施日 | 結果 | ステータス | 観測内容 |
|---|---|---|---|---|---|
| U1（旧P1a/P1b） | A | 2026-02-16 | Pass | 参考（非現実ケース） | `チームに参加` クリック後に認証画面へ遷移。認証後、`チーム名設定` と `招待フロー` を省略した招待付きオンボーディングを経由して参加完了。現実装では「未完了かつ未所属」が原則発生しないため、判定対象外。 |
| S8 | A | 2026-02-16 | Fail | 旧実装結果（再検証待ち） | 一度使用された招待リンクを別ユーザーで開いた際、本来は無効招待エラーになるべきだが、参加できてしまった。`consume_invite` / `create_invite` 導入前の記録。 |
| P7 | B | 2026-02-16 | Fail | 有効 | リンククリック → ブラウザ起動 → 「このページをKaetaで開きますか？」モーダルで `開く` を押下 → アプリ遷移直後に `招待リンクエラー` 画面へ遷移。想定の `alreadyHasFamily` 分岐に到達しなかった。 |
