# 写真管理・圧縮・同期設計書

## 写真管理・圧縮・同期フロー

| ステップ | 動作内容 | 使用パッケージ |
|----------|----------|----------------|
| **1. 撮影** | カメラを起動し、高画質な写真を取得（一時保存） | `image_picker` |
| **2. 圧縮** | 写真のサイズをリサイズ（例：1080px）し、画質を調整。数MBのデータを200〜500KBまで軽量化 | `flutter_image_compress` |
| **3. アップ** | 軽量化されたデータのみをクラウドへ送信 | `supabase_flutter` |
| **4. 保存** | 生成された公開URLをDBの `imageUrl` に書き込む | `powersync` / `drift` |
| **5. 表示** | 一度表示した画像はスマホ内にキャッシュし、次回以降は通信なしで表示 | `cached_network_image` |

## 写真撮影のユーザー体験（UX）

### 撮影フロー

1. **撮影ボタン押下**
   
   `image_picker` パッケージにより、OS標準のカメラが起動

2. **撮影完了**
   
   撮影した画像（一時ファイル）のパスを取得

3. **アップロード**
   
   裏側でSupabase Storageへ送信

4. **紐付け**
   
   送信成功後、生成されたURLを Items テーブルのレコードに書き込む

## 写真容量設計

### 圧縮仕様

そのままアップロードすると1枚5MB以上になりますが、`flutter_image_compress` で適切に処理することで、劇的に軽量化します。

- **圧縮設定**: 解像度1080px程度、品質(Quality) 70〜80%
- **1枚あたりの想定サイズ**: 約250KB 〜 350KB
- **計算上の平均**: 1枚あたり 300KB と仮定

### ストレージ費用・容量試算（Supabase 無料枠 1GB）

| 項目 | 数値 | 備考 |
|------|------|------|
| **1枚あたりの容量** | 300 KB | 圧縮後の平均サイズ |
| **1人あたりの登録数** | 20 枚 | 間違えやすい商品に限定した想定 |
| **全体保存可能枚数** | 3,413 枚 | 無料枠 1,024MB における最大数 |
| **最大ユーザー数** | 170 人 | 無料枠内で維持できる限界人数 |