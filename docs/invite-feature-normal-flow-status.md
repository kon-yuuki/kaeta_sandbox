# 招待機能 通常フロー整理（特殊ケース除外）

最終更新日: 2026-02-22
対象: 通常の招待参加フローのみ（P6/P7/S8 は除外）

## 0. 用語定義（この資料内）
- Universal Link直起動:
  - `https://kaeta-jointeam.com/invite/<inviteId>` をタップした時に、ブラウザ画面を経由せずKaetaアプリが直接開く挙動。
- Webフォールバック:
  - 上記リンクタップ時に一度ブラウザページが開き、そこで `アプリで開く` ボタンを押してKaetaへ遷移する挙動。
  - ブラウザページには以下が表示される:
    - タイトル: `招待リンクを開きました`
    - ボタン: `アプリで開く`
    - ボタン: `アプリをインストール（TestFlight）`
    - 補助文: 開けない場合の `kaeta://invite/<inviteId>` 案内

## 1. 対象パターン一覧
| パターンID | 前提（受信者） | 正解フロー（期待） | 現状（最新） | 判定 |
|---|---|---|---|---|
| U1（旧P1a/P1b） | インストール済み / アカウントあり / オンボ未完了 | 招待リンク → 参加画面 → 認証（未ログイン時）→ 招待用オンボ（チーム名・招待ステップなし）→ 参加完了 | 期待どおり遷移し参加完了を確認済み | Pass |
| P2 | インストール済み / アカウントあり / オンボ完了 / ログイン済み / 未所属 | 招待リンク → 参加画面 → `参加してはじめる` → 即参加してホーム遷移 | 期待どおり即参加を確認済み | Pass |
| P3 | インストール済み / アカウントあり / オンボ完了 / 未ログイン / 未所属 | 招待リンク → 参加画面 → `参加してはじめる` → 既存アカウントログイン → 再オンボなしで参加完了 | 最新検証で参加完了まで確認済み（ブラウザフォールバック経由） | Pass（フォールバック導線） |
| P4a | 未インストール / 既存アカウントあり / オンボ完了 | 招待リンク（Web）→ TestFlight導線 → インストール → 再度招待導線 → 既存ログイン → 参加完了 | 最新検証で参加完了まで確認済み | Pass（フォールバック導線） |
| P4b | 未インストール / 既存アカウントあり / オンボ未完了 | 招待リンク（Web）→ インストール → 招待用オンボ（チーム名・招待ステップなし）→ 参加完了 | 期待どおり参加完了を確認済み | Pass |
| P5 | 未インストール / アカウントなし | 招待リンク（Web）→ インストール → 新規登録 → 招待用オンボ → 参加完了 | 最新検証で参加完了を確認済み | Pass |

## 2. 補足（通常フロー全体）
- 参加可否の観点では、通常パターン（U1/P2/P3/P4a/P4b/P5）で「参加できない」Failは最新時点で解消。
- ただし Universal Link の理想挙動（ブラウザを経由せず直接アプリ起動）は未達で、現状は Webフォールバック（`アプリで開く`）経由で成功。

## 3. 現状の到達フロー（通常パターン共通）
1. 招待リンク `https://kaeta-jointeam.com/invite/<inviteId>` を開く
2. 現状はブラウザでWebフォールバック画面が表示される
3. `アプリで開く` を押す
4. Kaetaの `参加してはじめる` 画面へ遷移
5. 受信者状態に応じて以下に分岐
   - 既存アカウント・オンボ完了: ログイン後に参加完了（再オンボなし）
   - 既存アカウント・オンボ未完了: 招待用オンボ経由で参加完了
   - 新規アカウント: 新規登録 + 招待用オンボ経由で参加完了

